<!DOCTYPE html>
<html>
<body>
<script>
window.addEventListener("message", (e) => {
    const data = e.data;

    if (data.type === "get") {
        const value = localStorage.getItem(data.key);
        e.source.postMessage({
            type: "getResult",
            key: data.key,
            value
        }, "*");
    }

    if (data.type === "set") {
        localStorage.setItem(data.key, data.value);
        e.source.postMessage({
            type: "setResult",
            key: data.key,
            status: "ok"
        }, "*");
    }

    if (data.type === "getAll") {
        const all = {};
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            all[key] = localStorage.getItem(key);
        }

        e.source.postMessage({
            type: "getAllResult",
            value: all
        }, "*");
    }
});
</script>
</body>
</html>
